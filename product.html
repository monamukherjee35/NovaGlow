<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - NovaGlow</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- Razorpay Checkout SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        .product-page {
            padding-top: 100px;
            min-height: 100vh;
            padding-bottom: var(--space-3xl);
        }

        .product-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3xl);
            margin-top: var(--space-2xl);
        }

        .product-gallery {
            position: sticky;
            top: 100px;
        }

        .main-image {
            width: 100%;
            aspect-ratio: 1;
            border-radius: var(--radius-xl);
            overflow: hidden;
            margin-bottom: var(--space-md);
            background: var(--gray-100);
        }

        .main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-list {
            display: flex;
            gap: var(--space-sm);
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition-base);
        }

        .thumbnail.active,
        .thumbnail:hover {
            border-color: var(--accent);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-details {
            padding: var(--space-lg) 0;
        }

        .product-category-tag {
            display: inline-block;
            padding: var(--space-xs) var(--space-md);
            background: rgba(212, 175, 55, 0.1);
            color: var(--accent-dark);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: var(--radius-full);
            margin-bottom: var(--space-md);
        }

        .product-title {
            font-size: 2rem;
            margin-bottom: var(--space-sm);
        }

        .product-pricing {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .product-pricing .price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .product-desc {
            color: var(--gray-600);
            line-height: 1.8;
            margin-bottom: var(--space-xl);
        }

        .product-meta {
            margin-bottom: var(--space-xl);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .meta-item i {
            width: 24px;
            color: var(--accent);
        }

        .meta-item strong {
            min-width: 100px;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .quantity-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1.25rem;
            transition: var(--transition-base);
        }

        .quantity-btn:hover {
            background: var(--gray-200);
        }

        .quantity-input {
            width: 60px;
            height: 40px;
            text-align: center;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: 1rem;
        }

        .product-details .product-actions {
            display: flex !important;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            position: static !important;
            opacity: 1 !important;
            transform: none !important;
            flex-direction: row !important;
        }

        .product-details .product-actions .btn {
            flex: 1;
            opacity: 1 !important;
        }

        .trust-badges {
            display: flex;
            gap: var(--space-lg);
            flex-wrap: wrap;
            padding: var(--space-lg);
            background: var(--gray-100);
            border-radius: var(--radius-lg);
        }

        .trust-badge {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .trust-badge i {
            color: var(--success);
        }

        .related-section {
            margin-top: var(--space-3xl);
        }

        @media (max-width: 1024px) {
            .product-detail {
                grid-template-columns: 1fr;
            }

            .product-gallery {
                position: static;
            }
        }

        /* Success Modal Styles */
        .success-content {
            text-align: center;
            padding: var(--space-xl);
        }

        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-lg);
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .success-content h2 {
            color: var(--success);
            margin-bottom: var(--space-sm);
        }

        .success-content p {
            color: var(--gray-500);
            margin-bottom: var(--space-xl);
        }

        /* Login Required Modal */
        .login-modal-content {
            text-align: center;
            padding: var(--space-xl);
        }

        .login-modal-content .login-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-lg);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .login-modal-content h2 {
            color: var(--primary);
            margin-bottom: var(--space-sm);
            font-size: 1.5rem;
        }

        .login-modal-content>p {
            color: var(--gray-500);
            margin-bottom: var(--space-xl);
        }

        .login-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .login-option-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-md);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-base);
            border: 2px solid var(--gray-200);
            background: white;
            font-size: 1rem;
        }

        .login-option-btn.google {
            background: white;
            color: var(--dark);
        }

        .login-option-btn.google:hover {
            background: var(--gray-100);
            border-color: var(--gray-300);
        }

        .login-option-btn.phone {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .login-option-btn.phone:hover {
            background: var(--primary-dark);
        }

        .login-option-btn img {
            width: 24px;
            height: 24px;
        }

        .login-benefits {
            background: var(--gray-100);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            text-align: left;
        }

        .login-benefits h4 {
            font-size: 0.875rem;
            margin-bottom: var(--space-sm);
            color: var(--primary);
        }

        .login-benefits ul {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .login-benefits li {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-xs);
        }

        .login-benefits li i {
            color: var(--success);
            font-size: 0.75rem;
        }

        /* Enhanced Checkout Modal Styles */
        .checkout-progress {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-xl);
            position: relative;
        }

        .checkout-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 25%;
            right: 25%;
            height: 3px;
            background: var(--gray-200);
            z-index: 0;
        }

        .checkout-progress .progress-fill {
            position: absolute;
            top: 20px;
            left: 25%;
            width: 0%;
            max-width: 50%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            z-index: 1;
            transition: width 0.4s ease;
        }

        .checkout-progress.step-2 .progress-fill {
            width: 50%;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
            z-index: 2;
            flex: 1;
        }

        .progress-step .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            background: var(--gray-200);
            color: var(--gray-500);
            transition: all 0.3s ease;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .progress-step.active .step-circle,
        .progress-step.completed .step-circle {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .progress-step.completed .step-circle {
            background: var(--success);
        }

        .progress-step .step-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-step.active .step-label {
            color: var(--primary);
        }

        .order-card {
            background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            border: 1px solid var(--gray-200);
        }

        .order-card-header {
            display: flex;
            gap: var(--space-md);
            align-items: center;
            padding-bottom: var(--space-md);
            border-bottom: 1px dashed var(--gray-300);
            margin-bottom: var(--space-md);
        }

        .order-card-header img {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-md);
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .order-card-header .product-info {
            flex: 1;
        }

        .order-card-header .product-info h4 {
            font-size: 1.1rem;
            margin-bottom: 4px;
            color: var(--dark);
        }

        .order-card-header .product-info .qty-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 10px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .order-card-header .product-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .price-breakdown {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .price-row.total {
            padding-top: var(--space-sm);
            border-top: 2px solid var(--gray-300);
            margin-top: var(--space-xs);
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--dark);
        }

        .price-row.total span:last-child {
            color: var(--primary);
        }

        .security-banner {
            background: linear-gradient(135deg, rgba(74, 14, 78, 0.08), rgba(212, 175, 55, 0.08));
            border: 1px solid rgba(74, 14, 78, 0.15);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .security-banner .security-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .security-banner .security-text h5 {
            font-size: 0.95rem;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .security-banner .security-text p {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin: 0;
        }

        .trust-strip {
            display: flex;
            justify-content: center;
            gap: var(--space-lg);
            flex-wrap: wrap;
            padding: var(--space-md);
            background: var(--gray-100);
            border-radius: var(--radius-md);
            margin-top: var(--space-md);
        }

        .trust-strip .trust-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .trust-strip .trust-item i {
            color: var(--success);
        }

        .delivery-estimate {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .delivery-estimate i {
            font-size: 1.5rem;
            color: var(--success);
        }

        .delivery-estimate .delivery-text {
            flex: 1;
        }

        .delivery-estimate .delivery-text strong {
            display: block;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .delivery-estimate .delivery-text span {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        /* Enhanced Form Styles */
        .checkout-form .form-group {
            margin-bottom: var(--space-md);
        }

        .checkout-form .form-label {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-weight: 500;
            margin-bottom: var(--space-xs);
            color: var(--dark);
        }

        .checkout-form .form-label i {
            color: var(--primary);
            font-size: 0.85rem;
        }

        .checkout-form .form-input {
            border: 2px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .checkout-form .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(74, 14, 78, 0.1);
        }

        .checkout-form .form-input.valid {
            border-color: var(--success);
        }

        .checkout-form .form-input.invalid {
            border-color: var(--error);
        }

        .input-helper {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .saved-address-card {
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .saved-address-card:hover {
            border-color: var(--primary);
            background: rgba(74, 14, 78, 0.05);
        }

        .saved-address-card.selected {
            border-color: var(--primary);
            background: rgba(74, 14, 78, 0.08);
        }

        .razorpay-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: #f8f9fa;
            border-radius: var(--radius-sm);
            margin-top: var(--space-md);
        }

        .razorpay-badge img {
            height: 20px;
        }

        .razorpay-badge span {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .pay-btn {
            background: linear-gradient(135deg, var(--primary) 0%, #6b1f70 100%);
            border: none;
            color: white;
            padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(74, 14, 78, 0.3);
        }

        .pay-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 14, 78, 0.4);
        }

        .pay-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .pay-btn .lock-icon {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-logo">
                <h1>Nova<span>Glow</span></h1>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="catalog.html">Catalog</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <div class="nav-actions">
                <a href="account/wishlist.html" class="nav-action-btn"><i class="far fa-heart"></i></a>
                <a href="account/cart.html" class="nav-action-btn"><i class="fas fa-shopping-bag"></i></a>
                <div id="auth-buttons"><a href="auth/login.html" class="btn btn-outline btn-sm">Login</a></div>
                <div id="user-menu" class="nav-user" style="display: none;"><i class="far fa-user-circle"
                        style="font-size: 1.5rem;"></i></div>
            </div>
        </div>
    </nav>

    <div class="product-page">
        <div class="container">
            <div class="product-detail">
                <div class="product-gallery">
                    <div class="main-image">
                        <img id="main-product-image" src="" alt="Product Image">
                    </div>
                    <div class="thumbnail-list" id="thumbnail-list"></div>
                </div>

                <div class="product-details">
                    <span class="product-category-tag" id="product-category"></span>
                    <h1 class="product-title" id="product-name"></h1>
                    <div class="product-pricing">
                        <span class="price" id="product-price"></span>
                    </div>
                    <p class="product-desc" id="product-description"></p>

                    <div class="product-meta">
                        <div class="meta-item">
                            <i class="fas fa-gem"></i>
                            <strong>Materials:</strong>
                            <span id="product-materials">-</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-certificate"></i>
                            <strong>Authenticity:</strong>
                            <span id="product-authenticity">100% Certified Genuine</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-truck"></i>
                            <strong>Delivery:</strong>
                            <span id="product-delivery-time">5-7 Business Days</span>
                        </div>
                        <div class="meta-item" id="shipping-cost-item">
                            <i class="fas fa-rupee-sign"></i>
                            <strong>Shipping:</strong>
                            <span id="product-shipping-cost">Free</span>
                        </div>
                    </div>

                    <div class="quantity-selector">
                        <span>Quantity:</span>
                        <button class="quantity-btn" id="qty-minus">-</button>
                        <input type="number" class="quantity-input" id="quantity" value="1" min="1">
                        <button class="quantity-btn" id="qty-plus">+</button>
                        <span id="stock-info"
                            style="margin-left: var(--space-md); color: var(--gray-500); font-size: 0.875rem;"></span>
                    </div>
                    <p id="stock-warning"
                        style="color: var(--warning); font-size: 0.875rem; margin-top: var(--space-sm); display: none;">
                        <i class="fas fa-exclamation-triangle"></i> <span id="stock-warning-text"></span>
                    </p>

                    <div class="product-actions">
                        <button class="btn btn-accent btn-lg" id="buy-now-btn">
                            <i class="fas fa-shopping-bag"></i> Buy Now
                        </button>
                        <button class="btn btn-outline btn-lg" id="add-cart-btn">
                            Add to Cart
                        </button>
                        <button class="btn btn-ghost btn-icon" id="wishlist-btn" title="Add to Wishlist">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>

                    <div class="trust-badges" id="trust-badges">
                        <div class="trust-badge" id="badge-authenticity"><i class="fas fa-check-circle"></i>
                            <span>Genuine Products</span>
                        </div>
                        <div class="trust-badge" id="badge-packaging"><i class="fas fa-shield-alt"></i> <span>Secure
                                Packaging</span></div>
                        <div class="trust-badge" id="badge-returns" style="display:none;"><i class="fas fa-undo"></i>
                            Easy Returns</div>
                        <div class="trust-badge" id="badge-cod" style="display:none;"><i class="fas fa-money-bill"></i>
                            COD Available</div>
                        <div class="trust-badge" id="badge-free-delivery" style="display:none;"><i
                                class="fas fa-truck"></i> Free Delivery</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Multi-Step Checkout Modal -->
    <div class="modal-overlay" id="inquiry-modal">
        <div class="modal" style="max-width: 580px;">
            <div class="modal-header">
                <h3><i class="fas fa-shopping-bag gold-text"></i> <span id="modal-title">Secure Checkout</span></h3>
                <button class="modal-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <!-- Enhanced Step Indicator -->
                <div class="checkout-progress" id="checkout-progress">
                    <div class="progress-fill"></div>
                    <div class="progress-step active" id="progress-step-1">
                        <span class="step-circle">1</span>
                        <span class="step-label">Review</span>
                    </div>
                    <div class="progress-step" id="progress-step-2">
                        <span class="step-circle">2</span>
                        <span class="step-label">Details</span>
                    </div>
                </div>

                <!-- Step 1: Order Summary (Enhanced) -->
                <div id="checkout-step-1">
                    <!-- Order Card -->
                    <div class="order-card">
                        <div class="order-card-header">
                            <img id="modal-product-image" src="" alt="Product">
                            <div class="product-info">
                                <h4 id="modal-product-name">Product Name</h4>
                                <span class="qty-badge">Qty: <span id="modal-qty">1</span></span>
                            </div>
                            <div class="product-price" id="modal-product-price">₹0</div>
                        </div>
                        <div class="price-breakdown">
                            <div class="price-row">
                                <span>Subtotal</span>
                                <span id="summary-subtotal">₹0</span>
                            </div>
                            <div class="price-row">
                                <span>Shipping</span>
                                <span id="summary-shipping" style="color: var(--success);">Free</span>
                            </div>
                            <div class="price-row total">
                                <span>Total Amount</span>
                                <span id="summary-total">₹0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Estimate -->
                    <div class="delivery-estimate">
                        <i class="fas fa-truck"></i>
                        <div class="delivery-text">
                            <strong id="delivery-estimate-text">Estimated Delivery: 5-7 Business Days</strong>
                            <span>Free shipping on this order</span>
                        </div>
                    </div>

                    <!-- Security Banner -->
                    <div class="security-banner">
                        <div class="security-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="security-text">
                            <h5>100% Secure Payment</h5>
                            <p>Pay safely using Razorpay - UPI, Cards, NetBanking & Wallets</p>
                        </div>
                    </div>

                    <!-- Trust Strip -->
                    <div class="trust-strip">
                        <div class="trust-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Genuine Products</span>
                        </div>
                        <div class="trust-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Secure Packaging</span>
                        </div>
                        <div class="trust-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Easy Returns</span>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Customer Details (Enhanced) -->
                <div id="checkout-step-2" style="display: none;">
                    <form id="inquiry-form" class="checkout-form">
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-user"></i> Full Name *</label>
                            <input type="text" class="form-input" id="inq-name" placeholder="Enter your full name"
                                required>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-envelope"></i> Email Address *</label>
                            <input type="email" class="form-input" id="inq-email" placeholder="your@email.com" required>
                            <p class="input-helper">Order confirmation will be sent to this email</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-phone"></i> Contact Number *</label>
                            <input type="tel" class="form-input" id="inq-phone" placeholder="10-digit mobile number"
                                required>
                            <p class="input-helper">For delivery updates and coordination</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-map-marker-alt"></i> Delivery Address *</label>
                            <textarea class="form-input form-textarea" id="inq-address" rows="3"
                                placeholder="House/Flat No., Street, Landmark&#10;City, State - PIN Code"
                                required></textarea>
                        </div>
                        <div class="form-group" id="saved-addresses-group" style="display: none;">
                            <label class="form-label"><i class="fas fa-bookmark"></i> Or select saved address:</label>
                            <select class="form-input form-select" id="saved-addresses">
                                <option value="">Choose a saved address...</option>
                            </select>
                        </div>
                    </form>

                    <!-- Razorpay Badge -->
                    <div class="razorpay-badge">
                        <i class="fas fa-lock" style="color: var(--success);"></i>
                        <span>Secured by Razorpay - 256-bit SSL Encryption</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="flex-direction: column; gap: var(--space-md);">
                <div style="display: flex; gap: var(--space-md); width: 100%;">
                    <button class="btn btn-ghost" id="checkout-back-btn" style="display: none; flex: 1;">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-ghost modal-close" id="checkout-cancel-btn" style="flex: 1;">Cancel</button>
                    <button class="btn btn-accent" id="checkout-next-btn" style="flex: 2;">
                        Continue <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="pay-btn" id="submit-inquiry" style="display: none; flex: 2;">
                        <span class="lock-icon"><i class="fas fa-lock"></i></span>
                        Pay Securely <span id="pay-btn-amount">₹0</span>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Success Modal -->
    <div class="modal-overlay" id="success-modal">
        <div class="modal" style="max-width: 480px;">
            <div class="modal-body" style="padding: var(--space-2xl);">
                <div class="success-content" style="text-align: center;">
                    <div class="success-icon"
                        style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--success), #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-lg); box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);">
                        <i class="fas fa-check" style="font-size: 2.5rem; color: white;"></i>
                    </div>
                    <h2 style="color: var(--success); margin-bottom: var(--space-sm);">Payment Successful!</h2>
                    <p id="success-order-number"
                        style="font-size: 1.1rem; font-weight: 600; color: var(--primary); margin-bottom: var(--space-md);">
                        #ORD-XXXXXX</p>

                    <div
                        style="background: var(--gray-100); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-lg); text-align: left;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-xs);">
                            <span style="color: var(--gray-500);">Product</span>
                            <span id="success-product-name" style="font-weight: 500;">-</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-xs);">
                            <span style="color: var(--gray-500);">Amount Paid</span>
                            <span id="success-amount" style="font-weight: 600; color: var(--primary);">₹0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-500);">Status</span>
                            <span style="color: var(--success); font-weight: 500;"><i class="fas fa-check-circle"></i>
                                Confirmed</span>
                        </div>
                    </div>

                    <p style="color: var(--gray-500); font-size: 0.9rem; margin-bottom: var(--space-lg);">
                        We'll notify you when your order is shipped. You can track your order in My Orders.
                    </p>

                    <div style="display: flex; gap: var(--space-md); justify-content: center;">
                        <button class="btn btn-outline" onclick="window.location.href='account/orders.html'">
                            <i class="fas fa-box"></i> View My Orders
                        </button>
                        <button class="btn btn-primary" onclick="window.location.href='catalog.html'">
                            Continue Shopping
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Required Modal -->
    <div class="modal-overlay" id="login-required-modal">
        <div class="modal" style="max-width: 420px;">
            <div class="modal-header">
                <h3><i class="fas fa-lock gold-text"></i> Login Required</h3>
                <button class="modal-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="login-modal-content">
                    <div class="login-icon">
                        <i class="fas fa-user-lock"></i>
                    </div>
                    <h2>Please Login to Continue</h2>
                    <p>Sign in to complete your purchase and enjoy exclusive benefits!</p>

                    <div class="login-options">
                        <button class="login-option-btn google" id="google-login-btn">
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                            Continue with Google
                        </button>
                        <button class="login-option-btn phone" id="phone-login-btn">
                            <i class="fas fa-mobile-alt"></i>
                            Login with Phone Number
                        </button>
                    </div>

                    <div class="login-benefits">
                        <h4><i class="fas fa-sparkles"></i> Benefits of signing in:</h4>
                        <ul>
                            <li><i class="fas fa-check-circle"></i> Track your orders in real-time</li>
                            <li><i class="fas fa-check-circle"></i> Save addresses for faster checkout</li>
                            <li><i class="fas fa-check-circle"></i> Create wishlists and save favorites</li>
                            <li><i class="fas fa-check-circle"></i> Get exclusive offers & updates</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom" style="border-top: none; padding-top: 0;">
                <p>&copy; 2025 NovaGlow. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div class="toast-container" id="toast-container"></div>

    <script type="module">
        import { auth, db, googleProvider } from './js/firebase-config.js';
        import { doc, getDoc, updateDoc, arrayUnion, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { onAuthStateChanged, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { setDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        let currentProduct = null;
        let currentUser = null;
        let userData = null;
        let pendingBuyAction = false; // Track if user was trying to buy before login

        function formatPrice(price) {
            return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 0 }).format(price);
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Load product from Firestore
        async function loadProduct() {
            const urlParams = new URLSearchParams(window.location.search);

            // Check for payment return status
            const paymentStatus = urlParams.get('status');
            if (paymentStatus === 'success') {
                const pendingOrderStr = sessionStorage.getItem('pendingOrder');
                if (pendingOrderStr) {
                    try {
                        const pendingOrder = JSON.parse(pendingOrderStr);

                        // Generate unique Order Number
                        const orderNumber = '#ORD-' + Math.floor(100000 + Math.random() * 900000);

                        // Save order to Firestore
                        await addDoc(collection(db, 'orders'), {
                            orderNumber: orderNumber,
                            userId: currentUser?.uid || null,
                            productId: pendingOrder.productId,
                            productName: pendingOrder.productName,
                            productPrice: pendingOrder.productPrice,
                            productImage: pendingOrder.productImage,
                            quantity: pendingOrder.quantity,
                            shippingCost: pendingOrder.shippingCost,
                            totalAmount: pendingOrder.totalAmount,
                            customerName: pendingOrder.customerName,
                            customerEmail: pendingOrder.customerEmail,
                            customerPhone: pendingOrder.customerPhone,
                            deliveryAddress: pendingOrder.deliveryAddress,
                            status: 'paid',
                            paymentStatus: 'paid',
                            paymentId: pendingOrder.txnid,
                            paymentMethod: 'payu',
                            txnid: pendingOrder.txnid,
                            createdAt: serverTimestamp()
                        });

                        // Update stock
                        const productDoc = await getDoc(doc(db, 'products', pendingOrder.productId));
                        if (productDoc.exists()) {
                            const currentStock = productDoc.data().stockQuantity || 1;
                            const newStockQty = Math.max(0, currentStock - pendingOrder.quantity);
                            await updateDoc(doc(db, 'products', pendingOrder.productId), {
                                stockQuantity: newStockQty,
                                stockStatus: newStockQty <= 0 ? 'sold' : 'available'
                            });
                        }

                        // Populate success modal
                        document.getElementById('success-order-number').textContent = orderNumber;
                        document.getElementById('success-product-name').textContent = pendingOrder.productName;
                        document.getElementById('success-amount').textContent = formatPrice(pendingOrder.totalAmount);

                        document.getElementById('success-modal').classList.add('active');
                        showToast('Payment Successful! Order Placed.', 'success');

                        // Clear pending order
                        sessionStorage.removeItem('pendingOrder');

                        // Clean URL
                        window.history.replaceState({}, document.title, window.location.pathname + window.location.search.replace(/[?&]status=success/, ''));
                    } catch (err) {
                        console.error('Error saving order after payment:', err);
                        showToast('Payment successful but error saving order. Contact support.', 'error');
                    }
                }
            } else if (paymentStatus === 'failure') {
                showToast('Payment failed. Please try again.', 'error');
                sessionStorage.removeItem('pendingOrder');
                window.history.replaceState({}, document.title, window.location.pathname + window.location.search.replace(/[?&]status=failure/, ''));
            }

            const productId = urlParams.get('id');

            if (!productId && !paymentStatus) {
                window.location.href = 'catalog.html';
                return;
            } else if (!productId && paymentStatus) {
                // If we have status but no ID, we might have lost potential to show product, but usually ID is preserved in URL or can be retrieved from pendingOrder
                if (sessionStorage.getItem('pendingOrder')) {
                    const pending = JSON.parse(sessionStorage.getItem('pendingOrder'));
                    window.location.href = `product.html?id=${pending.productId}`;
                    return;
                }
                window.location.href = 'catalog.html';
                return;
            }

            try {
                const productDoc = await getDoc(doc(db, 'products', productId));

                if (!productDoc.exists()) {
                    showToast('Product not found', 'error');
                    setTimeout(() => window.location.href = 'catalog.html', 1500);
                    return;
                }

                currentProduct = { id: productDoc.id, ...productDoc.data() };

                document.title = `${currentProduct.name} - NovaGlow`;
                document.getElementById('product-name').textContent = currentProduct.name;
                document.getElementById('product-category').textContent = currentProduct.category || 'Jewelry';
                document.getElementById('product-price').textContent = formatPrice(currentProduct.price);
                document.getElementById('product-description').textContent = currentProduct.description || 'A beautiful piece from our exquisite collection.';
                document.getElementById('product-materials').textContent = currentProduct.materials || '-';

                // Handle images - support both single image and array of images
                let images = [];
                if (Array.isArray(currentProduct.images) && currentProduct.images.length > 0) {
                    images = currentProduct.images;
                } else if (currentProduct.image) {
                    images = [currentProduct.image];
                }

                const mainImageIndex = currentProduct.mainImageIndex || 0;
                const mainImage = images[mainImageIndex] || images[0] || 'https://via.placeholder.com/800x800?text=Product';

                document.getElementById('main-product-image').src = mainImage;
                document.getElementById('main-product-image').onerror = function () {
                    this.src = 'https://via.placeholder.com/800x800?text=Product';
                };

                // Render thumbnail gallery if multiple images
                const thumbnailList = document.getElementById('thumbnail-list');
                if (images.length > 1) {
                    thumbnailList.innerHTML = images.map((img, index) => `
                        <div class="thumbnail ${index === mainImageIndex ? 'active' : ''}" data-index="${index}">
                            <img src="${img}" alt="Product image ${index + 1}" onerror="this.src='https://via.placeholder.com/80x80?text=Image'">
                        </div>
                    `).join('');

                    // Add click handlers to thumbnails
                    thumbnailList.querySelectorAll('.thumbnail').forEach(thumb => {
                        thumb.addEventListener('click', () => {
                            const index = parseInt(thumb.dataset.index);
                            document.getElementById('main-product-image').src = images[index];
                            thumbnailList.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                            thumb.classList.add('active');
                        });
                    });
                } else {
                    thumbnailList.innerHTML = '';
                }

                // Check stock status
                const stockStatus = currentProduct.stockStatus || 'available';
                if (stockStatus === 'sold') {
                    document.getElementById('buy-now-btn').disabled = true;
                    document.getElementById('buy-now-btn').innerHTML = '<i class="fas fa-times-circle"></i> Sold';
                    document.getElementById('buy-now-btn').style.opacity = '0.5';
                    document.getElementById('add-cart-btn').disabled = true;
                    document.getElementById('add-cart-btn').textContent = 'Not Available';
                    document.getElementById('add-cart-btn').style.opacity = '0.5';
                }

                // Display delivery options
                document.getElementById('product-delivery-time').textContent = currentProduct.deliveryTime || '5-7 Business Days';
                document.getElementById('product-authenticity').textContent = currentProduct.authenticity || '100% Certified Genuine';

                // Shipping cost display
                const shippingCost = currentProduct.shippingCost || 0;
                const freeDelivery = currentProduct.freeDelivery === true;
                if (freeDelivery || shippingCost === 0) {
                    document.getElementById('product-shipping-cost').textContent = 'Free';
                    document.getElementById('product-shipping-cost').style.color = 'var(--success)';
                    document.getElementById('badge-free-delivery').style.display = 'flex';
                } else {
                    document.getElementById('product-shipping-cost').textContent = formatPrice(shippingCost);
                }

                // COD availability
                if (currentProduct.codAvailable !== false) {
                    document.getElementById('badge-cod').style.display = 'flex';
                }

                // Easy returns
                if (currentProduct.returnable !== false) {
                    document.getElementById('badge-returns').style.display = 'flex';
                }

                // Custom authenticity and packaging badges
                if (currentProduct.authenticity) {
                    document.querySelector('#badge-authenticity span').textContent = currentProduct.authenticity;
                }
                if (currentProduct.packaging) {
                    document.querySelector('#badge-packaging span').textContent = currentProduct.packaging;
                }

                // Modal product info - use main image
                document.getElementById('modal-product-image').src = mainImage;
                document.getElementById('modal-product-name').textContent = currentProduct.name;
                document.getElementById('modal-product-price').textContent = formatPrice(currentProduct.price);

                // Update stock display
                setTimeout(() => updateStockDisplay(), 100);
            } catch (error) {
                console.error('Error loading product:', error);
                showToast('Error loading product', 'error');
                setTimeout(() => window.location.href = 'catalog.html', 1500);
            }
        }

        // Stock display and validation
        function updateStockDisplay() {
            const stock = currentProduct.stockQuantity ?? 1;
            const stockInfo = document.getElementById('stock-info');
            const stockWarning = document.getElementById('stock-warning');
            const stockWarningText = document.getElementById('stock-warning-text');
            const buyBtn = document.getElementById('buy-now-btn');
            const addCartBtn = document.getElementById('add-cart-btn');
            const qtyInput = document.getElementById('quantity');
            const requestedQty = parseInt(qtyInput.value) || 1;

            // Update stock info display
            if (stock <= 0) {
                stockInfo.innerHTML = '<span style="color: var(--error); font-weight: 600;">Out of Stock</span>';
                buyBtn.disabled = true;
                addCartBtn.disabled = true;
                buyBtn.innerHTML = '<i class="fas fa-times-circle"></i> Out of Stock';
                stockWarning.style.display = 'none';
            } else if (stock <= 3) {
                stockInfo.innerHTML = `<span style="color: var(--warning); font-weight: 500;">Only ${stock} left!</span>`;
                qtyInput.max = stock;
            } else {
                stockInfo.innerHTML = `<span style="color: var(--success);">${stock} in stock</span>`;
                qtyInput.max = stock;
            }

            // Validate requested quantity
            if (stock > 0 && requestedQty > stock) {
                stockWarning.style.display = 'block';
                stockWarningText.textContent = `Only ${stock} item${stock > 1 ? 's' : ''} available in stock.`;
                qtyInput.value = stock;
            } else {
                stockWarning.style.display = 'none';
            }
        }

        // Quantity controls with stock validation
        document.getElementById('qty-minus').addEventListener('click', () => {
            const input = document.getElementById('quantity');
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
                updateStockDisplay();
            }
        });

        document.getElementById('qty-plus').addEventListener('click', () => {
            const input = document.getElementById('quantity');
            const stock = currentProduct?.stockQuantity ?? 999;
            const newVal = parseInt(input.value) + 1;

            if (newVal <= stock) {
                input.value = newVal;
            } else {
                document.getElementById('stock-warning').style.display = 'block';
                document.getElementById('stock-warning-text').textContent = `Only ${stock} item${stock > 1 ? 's' : ''} available in stock.`;
            }
            updateStockDisplay();
        });

        document.getElementById('quantity').addEventListener('change', () => {
            updateStockDisplay();
        });

        // Helper to update order summary
        function updateOrderSummary() {
            const qty = parseInt(document.getElementById('quantity').value);
            const price = currentProduct.price;
            const shipping = (currentProduct.freeDelivery || currentProduct.shippingCost === 0) ? 0 : (currentProduct.shippingCost || 0);
            const subtotal = price * qty;
            const total = subtotal + shipping;

            document.getElementById('modal-qty').textContent = qty;
            document.getElementById('modal-product-price').textContent = formatPrice(price);
            document.getElementById('summary-subtotal').textContent = formatPrice(subtotal);

            if (shipping === 0) {
                document.getElementById('summary-shipping').textContent = 'Free';
                document.getElementById('summary-shipping').style.color = 'var(--success)';
            } else {
                document.getElementById('summary-shipping').textContent = formatPrice(shipping);
                document.getElementById('summary-shipping').style.color = '';
            }

            document.getElementById('summary-total').textContent = formatPrice(total);
            document.getElementById('pay-btn-amount').textContent = formatPrice(total);
        }

        // Reset checkout to Step 1
        function resetCheckoutToStep1() {
            document.getElementById('checkout-step-1').style.display = 'block';
            document.getElementById('checkout-step-2').style.display = 'none';
            document.getElementById('checkout-next-btn').style.display = 'inline-flex';
            document.getElementById('submit-inquiry').style.display = 'none';
            document.getElementById('checkout-back-btn').style.display = 'none';
            document.getElementById('checkout-cancel-btn').style.display = 'inline-flex';
            document.getElementById('modal-title').textContent = 'Secure Checkout';

            // Reset progress bar
            document.getElementById('checkout-progress').classList.remove('step-2');
            document.getElementById('progress-step-1').classList.add('active');
            document.getElementById('progress-step-1').classList.remove('completed');
            document.getElementById('progress-step-2').classList.remove('active');
        }

        // Buy Now - Redirect to Checkout Page
        document.getElementById('buy-now-btn').addEventListener('click', () => {
            // Check if user is logged in
            if (!currentUser) {
                // Show login required modal
                pendingBuyAction = true;
                document.getElementById('login-required-modal').classList.add('active');
                return;
            }

            // Prepare checkout data
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const checkoutData = {
                productId: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                image: currentProduct.images ? (currentProduct.images[currentProduct.mainImageIndex || 0] || currentProduct.images[0]) : currentProduct.image,
                quantity: quantity,
                freeDelivery: currentProduct.freeDelivery || false,
                shippingCost: currentProduct.shippingCost || 0
            };

            // Store in session and redirect
            sessionStorage.setItem('checkoutData', JSON.stringify(checkoutData));
            window.location.href = 'checkout.html';
        });

        // Open checkout modal function
        function openCheckoutModal() {
            const modal = document.getElementById('inquiry-modal');

            // Reset to Step 1
            resetCheckoutToStep1();

            // Update summary
            updateOrderSummary();

            // Update delivery estimate
            const deliveryTime = currentProduct.deliveryTime || '5-7 Business Days';
            document.getElementById('delivery-estimate-text').textContent = 'Estimated Delivery: ' + deliveryTime;

            // Prefill if logged in
            if (currentUser && userData) {
                document.getElementById('inq-name').value = userData.displayName || '';
                document.getElementById('inq-email').value = userData.email || currentUser.email || '';
                document.getElementById('inq-phone').value = userData.phone || '';

                // Show saved addresses if available
                if (userData.addresses && userData.addresses.length > 0) {
                    const group = document.getElementById('saved-addresses-group');
                    const select = document.getElementById('saved-addresses');
                    group.style.display = 'block';

                    select.innerHTML = '<option value="">Choose a saved address...</option>' +
                        userData.addresses.map((addr, i) => `<option value="${i}">${addr.label || 'Address'}: ${addr.address.substring(0, 40)}...</option>`).join('');

                    select.addEventListener('change', () => {
                        if (select.value !== '') {
                            const addr = userData.addresses[parseInt(select.value)];
                            document.getElementById('inq-address').value = `${addr.fullName}\n${addr.phone}\n${addr.address}, ${addr.city}, ${addr.state} - ${addr.pincode}`;
                        }
                    });
                }
            }

            modal.classList.add('active');
        }

        // Login modal handlers
        document.getElementById('google-login-btn').addEventListener('click', async () => {
            const btn = document.getElementById('google-login-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';

            try {
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;

                // Check if user document exists, create if not
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (!userDoc.exists()) {
                    await setDoc(doc(db, 'users', user.uid), {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || 'User',
                        role: 'customer',
                        phone: user.phoneNumber || '',
                        addresses: [],
                        cart: [],
                        wishlist: [],
                        liked: [],
                        createdAt: serverTimestamp()
                    });
                }

                showToast('Login successful!', 'success');
                document.getElementById('login-required-modal').classList.remove('active');

                // If there was a pending buy action, redirect to checkout
                if (pendingBuyAction) {
                    pendingBuyAction = false;
                    const quantity = parseInt(document.getElementById('quantity').value) || 1;
                    const checkoutData = {
                        productId: currentProduct.id,
                        name: currentProduct.name,
                        price: currentProduct.price,
                        image: currentProduct.images ? (currentProduct.images[currentProduct.mainImageIndex || 0] || currentProduct.images[0]) : currentProduct.image,
                        quantity: quantity,
                        freeDelivery: currentProduct.freeDelivery || false,
                        shippingCost: currentProduct.shippingCost || 0
                    };
                    sessionStorage.setItem('checkoutData', JSON.stringify(checkoutData));
                    window.location.href = 'checkout.html';
                    return;
                }

                // User data will be loaded by onAuthStateChanged
            } catch (error) {
                console.error('Google sign-in error:', error);
                showToast('Sign-in failed. Please try again.', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google"> Continue with Google';
        });

        document.getElementById('phone-login-btn').addEventListener('click', () => {
            // Store the current URL to return after login
            sessionStorage.setItem('returnUrl', window.location.href + '#buy');
            window.location.href = 'auth/login.html';
        });

        // Step Navigation: Next (Step 1 → Step 2)
        document.getElementById('checkout-next-btn').addEventListener('click', () => {
            document.getElementById('checkout-step-1').style.display = 'none';
            document.getElementById('checkout-step-2').style.display = 'block';
            document.getElementById('checkout-next-btn').style.display = 'none';
            document.getElementById('submit-inquiry').style.display = 'flex';
            document.getElementById('checkout-back-btn').style.display = 'inline-flex';
            document.getElementById('checkout-cancel-btn').style.display = 'none';
            document.getElementById('modal-title').textContent = 'Delivery Details';

            // Update progress bar
            document.getElementById('checkout-progress').classList.add('step-2');
            document.getElementById('progress-step-1').classList.remove('active');
            document.getElementById('progress-step-1').classList.add('completed');
            document.getElementById('progress-step-2').classList.add('active');
        });

        // Step Navigation: Back (Step 2 → Step 1)
        document.getElementById('checkout-back-btn').addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            resetCheckoutToStep1();
        });

        // Close modals
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
                resetCheckoutToStep1();
            });
        });

        // Submit Order with Razorpay
        document.getElementById('submit-inquiry').addEventListener('click', async () => {
            const name = document.getElementById('inq-name').value.trim();
            const email = document.getElementById('inq-email').value.trim();
            const phone = document.getElementById('inq-phone').value.trim();
            const address = document.getElementById('inq-address').value.trim();

            if (!name || !email || !phone || !address) {
                showToast('Please fill all required fields', 'error');
                return;
            }

            // Validate phone number
            if (!/^[6-9]\d{9}$/.test(phone)) {
                showToast('Please enter a valid 10-digit mobile number', 'error');
                return;
            }

            // Validate email
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }

            const btn = document.getElementById('submit-inquiry');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Initializing Payment...';

            try {
                const quantity = parseInt(document.getElementById('quantity').value);
                const price = currentProduct.price;
                const shipping = (currentProduct.freeDelivery || currentProduct.shippingCost === 0) ? 0 : (currentProduct.shippingCost || 0);
                const totalAmount = (price * quantity) + shipping;

                // ============================================
                // RAZORPAY CONFIGURATION
                // ============================================
                // Replace 'YOUR_LIVE_KEY_ID' with your actual Razorpay Live Key ID
                // Get your keys from: https://dashboard.razorpay.com/app/keys
                const RAZORPAY_KEY_ID = 'rzp_live_S2A4DCsVnVxHHC';
                // ============================================

                // Generate unique order reference
                const orderRef = 'ORD' + Date.now() + Math.floor(Math.random() * 1000);

                // Razorpay Checkout Options
                const options = {
                    key: RAZORPAY_KEY_ID,
                    amount: Math.round(totalAmount * 100), // Amount in paise (INR × 100)
                    currency: 'INR',
                    name: 'NovaGlow',
                    description: currentProduct.name + (quantity > 1 ? ` (Qty: ${quantity})` : ''),
                    image: 'https://i.imgur.com/yourlogo.png', // Optional: Add your logo URL
                    prefill: {
                        name: name,
                        email: email,
                        contact: phone
                    },
                    notes: {
                        productId: currentProduct.id,
                        productName: currentProduct.name,
                        quantity: quantity,
                        address: address,
                        orderRef: orderRef
                    },
                    theme: {
                        color: '#4a0e4e', // NovaGlow primary color
                        backdrop_color: 'rgba(0,0,0,0.7)'
                    },
                    modal: {
                        ondismiss: function () {
                            btn.disabled = false;
                            btn.innerHTML = '<span class="lock-icon"><i class="fas fa-lock"></i></span> Pay Securely <span id="pay-btn-amount">' + formatPrice(totalAmount) + '</span>';
                            showToast('Payment cancelled', 'warning');
                        }
                    },
                    handler: async function (response) {
                        // Payment successful
                        try {
                            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Confirming Order...';

                            // Generate Order Number
                            const orderNumber = '#ORD-' + Math.floor(100000 + Math.random() * 900000);

                            // Save order to Firestore
                            await addDoc(collection(db, 'orders'), {
                                orderNumber: orderNumber,
                                userId: currentUser?.uid || null,
                                productId: currentProduct.id,
                                productName: currentProduct.name,
                                productPrice: currentProduct.price,
                                productImage: currentProduct.images ? (currentProduct.images[currentProduct.mainImageIndex || 0] || currentProduct.images[0]) : currentProduct.image,
                                quantity: quantity,
                                shippingCost: shipping,
                                totalAmount: totalAmount,
                                customerName: name,
                                customerEmail: email,
                                customerPhone: phone,
                                deliveryAddress: address,
                                status: 'confirmed',
                                paymentStatus: 'paid',
                                paymentMethod: 'razorpay',
                                razorpayPaymentId: response.razorpay_payment_id,
                                razorpayOrderId: response.razorpay_order_id || null,
                                razorpaySignature: response.razorpay_signature || null,
                                createdAt: serverTimestamp()
                            });

                            // Update stock
                            const productDoc = await getDoc(doc(db, 'products', currentProduct.id));
                            if (productDoc.exists()) {
                                const currentStock = productDoc.data().stockQuantity || 1;
                                const newStockQty = Math.max(0, currentStock - quantity);
                                await updateDoc(doc(db, 'products', currentProduct.id), {
                                    stockQuantity: newStockQty,
                                    stockStatus: newStockQty <= 0 ? 'sold' : 'available'
                                });
                            }

                            // Close checkout modal
                            document.getElementById('inquiry-modal').classList.remove('active');

                            // Show success modal
                            document.getElementById('success-order-number').textContent = orderNumber;
                            document.getElementById('success-product-name').textContent = currentProduct.name;
                            document.getElementById('success-amount').textContent = formatPrice(totalAmount);
                            document.getElementById('success-modal').classList.add('active');

                            showToast('Payment Successful! Order Confirmed.', 'success');

                            // Reset button
                            btn.disabled = false;
                            btn.innerHTML = '<span class="lock-icon"><i class="fas fa-lock"></i></span> Pay Securely <span id="pay-btn-amount">' + formatPrice(totalAmount) + '</span>';
                            resetCheckoutToStep1();

                        } catch (error) {
                            console.error('Error saving order:', error);
                            showToast('Payment received but error saving order. Please contact support with payment ID: ' + response.razorpay_payment_id, 'error');
                            btn.disabled = false;
                            btn.innerHTML = '<span class="lock-icon"><i class="fas fa-lock"></i></span> Pay Securely <span id="pay-btn-amount">' + formatPrice(totalAmount) + '</span>';
                        }
                    }
                };

                // Open Razorpay Checkout
                const rzp = new Razorpay(options);

                rzp.on('payment.failed', function (response) {
                    console.error('Payment failed:', response.error);
                    showToast('Payment failed: ' + (response.error.description || 'Please try again'), 'error');
                    btn.disabled = false;
                    btn.innerHTML = '<span class="lock-icon"><i class="fas fa-lock"></i></span> Pay Securely <span id="pay-btn-amount">' + formatPrice(totalAmount) + '</span>';
                });

                rzp.open();

            } catch (error) {
                console.error('Error initiating payment:', error);
                showToast('Error initiating payment. Please try again.', 'error');
                btn.disabled = false;
                btn.innerHTML = '<span class="lock-icon"><i class="fas fa-lock"></i></span> Pay Securely <span id="pay-btn-amount">₹0</span>';
            }
        });


        // Add to Cart
        document.getElementById('add-cart-btn').addEventListener('click', async () => {
            if (!currentUser) {
                showToast('Please login to add items to cart', 'warning');
                return;
            }

            try {
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    cart: arrayUnion({
                        productId: currentProduct.id,
                        quantity: parseInt(document.getElementById('quantity').value),
                        addedAt: new Date().toISOString()
                    })
                });
                showToast('Added to cart!', 'success');
            } catch (error) {
                showToast('Error adding to cart', 'error');
            }
        });

        // Add to Wishlist
        document.getElementById('wishlist-btn').addEventListener('click', async () => {
            if (!currentUser) {
                showToast('Please login to add to wishlist', 'warning');
                return;
            }

            try {
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, { wishlist: arrayUnion(currentProduct.id) });
                showToast('Added to wishlist!', 'success');
                document.getElementById('wishlist-btn').innerHTML = '<i class="fas fa-heart" style="color: var(--error);"></i>';
            } catch (error) {
                showToast('Error updating wishlist', 'error');
            }
        });

        // Auth state
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    userData = userDoc.data();
                }
                document.getElementById('auth-buttons').style.display = 'none';
                document.getElementById('user-menu').style.display = 'flex';

                // If user was trying to buy before login, open checkout
                if (pendingBuyAction) {
                    pendingBuyAction = false;
                    document.getElementById('login-required-modal').classList.remove('active');
                    setTimeout(() => openCheckoutModal(), 300);
                }
            }
        });

        // Initialize
        loadProduct().then(() => {
            // Auto-open buy modal if #buy hash is present
            if (window.location.hash === '#buy') {
                const stockStatus = currentProduct?.stockStatus || 'available';
                if (stockStatus !== 'sold') {
                    setTimeout(() => {
                        document.getElementById('buy-now-btn').click();
                    }, 500);
                }
            }
        });
    </script>
</body>

</html>